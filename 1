CREATE TABLE PUBLISHER(
NAME VARCHAR2 (20) PRIMARY KEY, 
PHONE INTEGER,
ADDRESS VARCHAR2 (20));

CREATE TABLE BOOK( 
BOOK_ID INTEGER PRIMARY KEY, 
TITLE VARCHAR2 (20), 
PUB_YEAR VARCHAR2 (20),
PUBLISHER_NAME REFERENCES PUBLISHER (NAME) ON DELETE CASCADE);


CREATE TABLE BOOK_AUTHORS 
(AUTHOR_NAME VARCHAR2 (20),
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE, 
PRIMARY KEY (BOOK_ID, AUTHOR_NAME));


CREATE TABLE LIBRARY_PROGRAM(
PROG_ID INTEGER PRIMARY KEY, 
PROG_NAME VARCHAR2 (50), 
ADDRESS VARCHAR2 (50));


CREATE TABLE BOOK_COPIES 
(NO_OF_COPIES INTEGER,
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
PROG_ID REFERENCES LIBRARY_BRANCH (BRANCH_ID) ON DELETE CASCADE,
PRIMARY KEY (BOOK_ID, BRANCH_ID));


CREATE TABLE BOOK_LENDING 
(DATE_OUT DATE,
DUE_DATE DATE,
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
PROG_ID REFERENCES LIBRARY_PROGRAM (PROG_ID) ON DELETE CASCADE,
CARD_NO NUMBER(4), 
PRIMARY KEY (BOOK_ID, PROG_ID));


//1//
SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,C.NO_OF_COPIES, L.PROG_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAM L
WHERE B.BOOK_ID=A.BOOK_ID 
AND B.BOOK_ID=C.BOOK_ID
AND L.PROG_ID=C.PROG_ID;


//2//
SELECT CARD_NO FROM 
BOOK_LENDING
WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '01-JUL-2017'
GROUP BY CARD_NO 
HAVING COUNT (*)>3;


//3//
DELETE FROM BOOK 
WHERE BOOK_ID=1;


//4//
SELECT PUB_YEAR FROM BOOK;
CREATE VIEW BOOKK_VIEW
AS 
SELECT PUB_YEAR FROM BOOK;


//5//
CREATE VIEW BOOK_ISSUE AS
SELECT COUNT(*) AS BOOK_ISSUED,BOOK_ID,PROG_ID
FROM BOOK_LENDING
GROUP BY BOOK_ID,PROG_ID;

CREATE VIEW BOOK_AVL AS 
SELECT BOOK_ID,PROG_ID,(N0_OF_COPIES-BOOK_ISSUED) AS AVBL_BOOKS
FROM BOOK_COPIES NATURAL JOIN BOOK_ISSUE;

SELECT * FROM BOOK_AVL NATURAL JOIN LIBRARY-PROGRAM;
